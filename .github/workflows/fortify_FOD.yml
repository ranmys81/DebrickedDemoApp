# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

################################################################################################################################################
# Fortify Application Security provides your team with solutions to empower DevSecOps practices, enable cloud transformation, and secure your  #
# software supply chain. To learn more about Fortify, start a free trial or contact our sales team, visit fortify.com.                         #
#                                                                                                                                              #
# Use this starter workflow as a basis for integrating Fortify Application Security Testing into your GitHub workflows. This template          #
# demonstrates the steps to package the code+dependencies, initiate a scan, and optionally import SAST vulnerabilities into GitHub Security    #
# Code Scanning Alerts. Additional information is available in the workflow comments and the Fortify AST Action / fcli / Fortify product       #
# documentation. If you need additional assistance, please contact Fortify support.                                                            #
################################################################################################################################################

name: Fortify FoD Scan

on:
  push:
    branches: [ main ]
  workflow_dispatch: {}

jobs:
  fortify-scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # FoD Uploader is a Java .jar, so we need Java
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'

      # Create a simple zip of the repo (FoD will analyze what it needs)
      - name: Zip source
        run: |
          sudo apt-get update
          sudo apt-get install -y zip
          zip -r source.zip . -x ".git/*"

      # IMPORTANT: Use EMEA base URL since your tenant is emea.fortify.com
      - name: Download FoD Uploader
        run: curl -L -o FoDUploader.jar https://emea.fortify.com/Tools/FoDUploader.jar

      - name: Upload & start scan in FoD
        run: |
          java -jar FoDUploader.jar \
            -z source.zip \
            -aurl https://emea.fortify.com \
            -rid 185870 \
            -tc "${{ secrets.FOD_CLIENT_ID }}" \
            -ts "${{ secrets.FOD_CLIENT_SECRET }}"
